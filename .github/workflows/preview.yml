name: Preview ë°°í¬

on:
  pull_request:
    branches:
      - main

permissions:
  pull-requests: write
  contents: read

jobs:
  preview:
    runs-on: ubuntu-latest

    steps:
      - name: Github ë ˆí¬ì§€í† ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸°
        uses: actions/checkout@v6

      - name: pnpm 10 ì„¤ì¹˜
        uses: pnpm/action-setup@v4
        with:
          version: 10

      - name: Node.js ì„¤ì¹˜
        uses: actions/setup-node@v6
        with:
          node-version: 24
          cache: pnpm

      - name: ì˜ì¡´ì„± ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
        run: pnpm install --frozen-lockfile

      - name: Vercel CLI ì„¤ì¹˜
        run: pnpm add -g vercel@latest

      - name: Vercel í™˜ê²½ ë³€ìˆ˜ ë¶ˆëŸ¬ì˜¤ê¸°
        run: vercel pull --yes --environment=preview --token=${{ secrets.VERCEL_TOKEN }}

      - name: í”„ë¡œì íŠ¸ ë¹Œë“œ
        run: vercel build --token=${{ secrets.VERCEL_TOKEN }}

      - name: Vercel ë°°í¬ (Preview)
        id: deploy-vercel
        run: |
          DEPLOY_URL=$(vercel deploy --prebuilt --token=${{ secrets.VERCEL_TOKEN }})
          echo "preview_url=$DEPLOY_URL" >> $GITHUB_OUTPUT

      - name: í˜„ì¬ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
        uses: josStorer/get-current-time@v2
        id: current-time
        with:
          format: 'YYYYë…„ MMì›” DDì¼ HHì‹œ mmë¶„'
          utcOffset: '+09:00'

      - name: PRì— Preview ë§í¬ ì½”ë©˜íŠ¸ ì¶”ê°€
        uses: thollander/actions-comment-pull-request@v3
        with:
          comment-tag: preview-link
          message: |
            ğŸ§· **ë°°í¬ ë¯¸ë¦¬ë³´ê¸°:** ${{ steps.deploy-vercel.outputs.preview_url }}
            â° **ìµœì¢… ì—…ë°ì´íŠ¸:** ${{ steps.current-time.outputs.formattedTime }}
